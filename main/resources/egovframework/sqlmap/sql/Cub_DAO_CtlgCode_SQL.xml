<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="dao_ctlgCode">
	<typeAlias alias="ctlgcodeVO" type="egovframework.main.service.VO.CtlgCodeVO"/>
	<typeAlias alias="listsearchVO" type="egovframework.main.service.VO.ListsearchVO"/>
	<typeAlias alias="sptlyCodeVO" type="egovframework.main.service.VO.SptlyCodeVO"/>

	<select id="sptlyCodeDAO.ctlgReset" parameterClass="sptlyCodeVO" resultClass="sptlyCodeVO">
		select cd as ctlg_cd
		from t_security_code
	where 1=0
	<isNotEmpty prepend = "OR" property="ctlg_cd">
	cd_nm =  #ctlg_cd# and cd like 'G%'
	</isNotEmpty>
	</select>
	<select id="ctlgCodeDAO.getCtlgCodeVO"  parameterClass="ctlgcodeVO" resultClass="ctlgcodeVO" >
	SELECT * FROM t_security_ctlg_cd
	</select>
	<select id="sptlyCodeDAO.getCtlgDataList" parameterClass="sptlyCodeVO" resultClass="sptlyCodeVO">
	select * from t_security_code
	where 1=0
	<isNotEmpty prepend = "OR" property="ctlg_cd">
		grp_cd = (SELECT cd
					FROM t_security_grp_cd
					WHERE cd_nm = '과업코드')	
		and cd like '%' || #ctlg_cd# || '%'
	</isNotEmpty>
	</select>
	<select id="sptlyCodeDAO.getActivityCtlgList" parameterClass="sptlyCodeVO" resultClass="sptlyCodeVO">
	SELECT
		incdt_idtf_cd,
		(select cd_nm from t_security_code where cd = ctlg_cd) as ctlg_cd,
		selctn_date,
		ctlg_itm_cd_1,
		ctlg_itm_cd_2,
		ctlg_itm_cd_3,
		ctlg_itm_cd_4,
		ctlg_itm_cd_5,
		ctlg_itm_cd_6,
		ctlg_itm_cd_7,
		ctlg_itm_cd_8,
		ctlg_itm_cd_9,
		ctlg_itm_cd_10,
		task,
		task_cd,
		seq
	FROM
		t_security_sprtly_ctlg
	where 
		incdt_idtf_cd = #incdt_idtf_cd#
		and task_cd = #task_cd#
		and ctlg_cd = (select cd from t_security_code where cd_nm = #ctlg_cd# and cd like '%G%' or cd = #ctlg_cd#)
	</select>
	<select id="sptlyCodeDAO.getTaskDataList" parameterClass="sptlyCodeVO" resultClass="sptlyCodeVO">
	SELECT
		incdt_idtf_cd,
		(select cd_nm from t_security_code where cd = ctlg_cd) as ctlg_cd,
		selctn_date,
		ctlg_itm_cd_1,
		ctlg_itm_cd_2,
		ctlg_itm_cd_3,
		ctlg_itm_cd_4,
		ctlg_itm_cd_5,
		ctlg_itm_cd_6,
		ctlg_itm_cd_7,
		ctlg_itm_cd_8,
		ctlg_itm_cd_9,
		ctlg_itm_cd_10,
		task,
		task_cd,
		seq
	FROM
		t_security_sprtly_ctlg
	where 
		incdt_idtf_cd = #incdt_idtf_cd#
		and ctlg_cd = (select cd from t_security_code where cd_nm = #ctlg_cd# and cd like '%G%' or cd = #ctlg_cd#)
	</select>
	
	<update id="sptlyCodeDAO.ChecklistReset" parameterClass="sptlyCodeVO">
	
	<isNotEmpty property="task_cd">
	Delete from t_security_sprtly_ctlg
	where task_cd = #task_cd#;
	</isNotEmpty>
	INSERT INTO
	t_security_sprtly_ctlg (
		incdt_idtf_cd,
		ctlg_cd,
		selctn_date,
		ctlg_itm_cd_1,
		ctlg_itm_cd_2,
		ctlg_itm_cd_3,
		ctlg_itm_cd_4,
		ctlg_itm_cd_5,
		ctlg_itm_cd_6,
		ctlg_itm_cd_7,
		ctlg_itm_cd_8,
		ctlg_itm_cd_9,
		ctlg_itm_cd_10,
		task,
		task_cd
		<isNotEmpty prepend="," property="seq">
		seq
		</isNotEmpty>
	)
	VALUES
	(
		#incdt_idtf_cd#,
		(select cd from t_security_code where cd_nm = #ctlg_cd# and cd like '%G%' or cd = #ctlg_cd#),
		sysdate,
		'',
		'',
		'',
		'',
		'',
		'',
		'',
		'',
		'',
		'',
		#task#,
		#task_cd#
		<isNotEmpty prepend="," property="seq">
		#seq#
		</isNotEmpty>
	);
	</update>
	<update id="sptlyCodeDAO.ChecklistPreset_Update" parameterClass="sptlyCodeVO">
	update t_security_sprtly_ctlg
	set ctlg_itm_cd_1 = #ctlg_itm_cd_1#,
	ctlg_itm_cd_2 = #ctlg_itm_cd_2#,
	ctlg_itm_cd_3 = #ctlg_itm_cd_3#,
	ctlg_itm_cd_4 = #ctlg_itm_cd_4#,
	ctlg_itm_cd_5 = #ctlg_itm_cd_5#,
	ctlg_itm_cd_6 = #ctlg_itm_cd_6#,
	ctlg_itm_cd_7 = #ctlg_itm_cd_7#,
	ctlg_itm_cd_8 = #ctlg_itm_cd_8#,
	ctlg_itm_cd_9 = #ctlg_itm_cd_9#,
	ctlg_itm_cd_10 = #ctlg_itm_cd_10#
	WHERE seq = #seq#
	</update>
	
	<select id="ctlgCodeDAO.getAllCtlgCodeList" resultClass="ctlgcodeVO">
	SELECT *
	FROM t_security_ctlg_cd
	</select>
	
	<select id="ctlgCodeDAO.getCtlgCodeListByLarge" parameterClass="String" resultClass="ctlgcodeVO">
	SELECT *,
		(SELECT cd_nm FROM t_security_code WHERE cd=A.lrgcls) AS lrgcls_nm,
		(SELECT cd_nm FROM t_security_code WHERE cd=A.mdcls) AS mdcls_nm
	FROM t_security_ctlg_cd A
	WHERE A.lrgcls = #large#
	GROUP BY A.mdcls
	</select>
	
	<select id="ctlgCodeDAO.getCtlgCodeListByMiddle" parameterClass="String" resultClass="ctlgcodeVO">
	SELECT *,
		(SELECT cd_nm FROM t_security_code WHERE cd=A.lrgcls) AS lrgcls_nm,
		(SELECT cd_nm FROM t_security_code WHERE cd=A.mdcls) AS mdcls_nm
	FROM t_security_ctlg_cd A
	WHERE A.mdcls = #middle#
	</select>
	
	<select id="ctlgCodeDAO.getCtlgCodeByAllCondition" parameterClass="ctlgcodeVO" resultClass="ctlgcodeVO">
	SELECT *,
		(SELECT cd_nm FROM t_security_code WHERE cd=A.lrgcls) AS lrgcls_nm,
		(SELECT cd_nm FROM t_security_code WHERE cd=A.mdcls) AS mdcls_nm
	FROM t_security_ctlg_cd A
		<dynamic prepend="WHERE"> 
			<isNotEmpty prepend="AND" property="lrgcls">
				A.lrgcls = #lrgcls#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="mdcls">
				A.mdcls = #mdcls#
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="ctlg_cd">
				ctlg_cd like '%' || #ctlg_cd# || '%'
			</isNotEmpty>
			<isNotEmpty prepend="AND" property="ctlg_nm">
				ctlg_nm like '%' || #ctlg_nm# || '%'
			</isNotEmpty>
		</dynamic>
	</select>
	
	<insert id="ctlgCodeDAO.insertCtlgCodeVO" parameterClass="ctlgcodeVO">
	INSERT INTO t_security_ctlg_cd
	( ctlg_cd, ctlg_nm, lrgcls, mdcls )
	VALUES
	( #ctlg_cd#, #ctlg_nm#, #lrgcls#, #mdcls# )
	</insert>
</sqlMap>